 <!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<style>body {margin:0;}</style>
	</head>
	<body onload="init()">
		
<img id="scream1" src="..\walking_30_right.png" width="30" height="30">
<img id="scream2" src="..\brick_01.jpg" width="30" height="30">
<img id="scream3" src="..\Diamond_30.png" width="30" height="30">
<img id="scream4" src="..\walking_30_left.png" width="30" height="30">
<canvas id="canvas-id" width="1270" height="700" style="border:1px solid #d3d3d3;">1122</canvas>
		<script>


	  

let ccc = document.getElementById("canvas-id");
let running = 0;			// Дали тича в момента
let running_step = 4;		// С колко да тича

const ctx = ccc.getContext('2d');
const img1 = document.getElementById("scream1");
const img2 = document.getElementById("scream2");
const img3 = document.getElementById("scream3");
const img4 = document.getElementById("scream4");


const moveX = 10;
const moveY = 10;
const stopX = 0;
const stopY = 0;

const START = {
            x: 90,
            y: 180,
};


const DefaultSize = 30;	// Колко е голямо стъпка/човече
 

// Стена 1
let StenaMax = 0;
//              0      1      2      3      4     5       6      7     8    9    10   11   12 	13	 14	  15   16   17  18
var stenaX = [" 5",  " 5",  " 5",  " 5",  " 5",  "15",  "16",  "17", "20", "3", "4", "5", "6", "7", "8", "9", "5", "5", "5"];
var stenaY = [" 7",  " 8",  " 9",  "10",  "11",  " 5",  " 5",  " 5", "15" ,"19","19","19","19","19","19","19","18","17","16"];

// Кошници за събиране
let Diamand_max = 2;
var DiamandX = ["10", " 3", " 8"];
var DiamandY = ["15", " 3", "12"];

let TextX_1 = 1050;
let TextY_1 = 20;
let TextY_redove = 20;

let CollectDiamonds = 0;




let i = 1;

  
  
  
let myX = START.x, myY = START.y, MYmoveX=stopX, MYmoveY=stopY;




function update_move(event) {
let udarena_nadolu = 0, udarena_nadiasno = 0, udarena = 0, udarena_naliavo= 0, udarena_nagore =0;
	let k;
	
	
	
//	window.console.log("natisnat e buton");

	
	document.addEventListener('keydown', KeyPressed);
	document.addEventListener('keyup', KeyUp);
       
  
	i=i+1;

	// Изтрива стария човечето
	ctx.clearRect (myX, myY , DefaultSize , DefaultSize );
	
	// Проверка за ударена кошница
	for (k = 1; k <= Diamand_max; k++) {

		ot_dolu   	= 0;
		ot_gore   	= 0;
		ot_liavo 	= 0;
		ot_diasno  	= 0;

		// Проверка за КОШНИЦА при движение НАДОЛУ
		if ( (myY+DefaultSize) == DiamandY[k]*DefaultSize && (myX+DefaultSize) >= DiamandX[k]*DefaultSize && myX <= (DiamandX[k]*DefaultSize+DefaultSize)   ) {		// Ударено е кубче номер К от вътрешните стени
			ot_dolu = 1;
			window.console.log("Y, OTDOLU-"+myY+" "+ot_dolu);
		}
		if ( myY == (DiamandY[k]*DefaultSize+DefaultSize) && (myX+DefaultSize) >= DiamandX[k]*DefaultSize && myX <= (DiamandX[k]*DefaultSize+DefaultSize)    )  {		// Ударено е кубче номер К от вътрешните стени
			ot_gore = 1;
			window.console.log("Y, OTGORE-"+myY+" "+ot_gore);
		}
		
		if ( myX  == (DiamandX[k]*DefaultSize+DefaultSize) && (myY+DefaultSize) >= DiamandY[k]*DefaultSize && myY <= (DiamandY[k]*DefaultSize+DefaultSize)    )  {		// Ударено е кубче номер К от вътрешните стени
			ot_liavo = 1;
			window.console.log("X-X-X-X, OT-LIAVO-"+myX+" "+ot_liavo);
		}
		// Готово
		if ( (myX+DefaultSize) == DiamandX[k]*DefaultSize && (myY+DefaultSize) >= DiamandY[k]*DefaultSize && myY <=  (DiamandY[k]*DefaultSize+DefaultSize)   )  {		// Ударено е кубче номер К от вътрешните стени
			ot_diasno = 1;
			window.console.log("XXXXXXX, NA-DIASNO-"+myX+" "+ot_diasno);
		}
		
		if ( ot_dolu != 0 || ot_gore != 0 || ot_liavo != 0 || ot_diasno != 0 ) {
			// Имаме удар в преграда, спира да проверява
			CollectDiamonds++;
			// Да трие кошницата
			ctx.clearRect ( DiamandX[k]*DefaultSize , DiamandY[k]*DefaultSize , 30 , 30 );	
			DiamandX[k] = 0;
			DiamandY[k] = 0;			
			break;
		}
		
	}

	// Проверка дали е ударено всяко едно блокче от стена
	for (k = 0; k <= StenaMax; k++) {

		ot_dolu   	= 0;
		ot_gore   	= 0;
		ot_liavo 	= 0;
		ot_diasno  	= 0;

		// Проверка за УДАРЕНА стена при движение НАДОЛУ
		if ( (myY+DefaultSize) == stenaY[k]*DefaultSize && (myX+DefaultSize) >= stenaX[k]*DefaultSize && myX <= (stenaX[k]*DefaultSize+DefaultSize)   ) {		// Ударено е кубче номер К от вътрешните стени
			ot_dolu = 1;
			window.console.log("Y, OTDOLU-"+myY+" "+ot_dolu);
		}
		if ( myY == (stenaY[k]*DefaultSize+DefaultSize) && (myX+DefaultSize) >= stenaX[k]*DefaultSize && myX <= (stenaX[k]*DefaultSize+DefaultSize)    )  {		// Ударено е кубче номер К от вътрешните стени
			ot_gore = 1;
			window.console.log("Y, OTGORE-"+myY+" "+ot_gore);
		}
		
		if ( myX  == (stenaX[k]*DefaultSize+DefaultSize) && (myY+DefaultSize) >= stenaY[k]*DefaultSize && myY <= (stenaY[k]*DefaultSize+DefaultSize)    )  {		// Ударено е кубче номер К от вътрешните стени
			ot_liavo = 1;
			window.console.log("X-X-X-X, OT-LIAVO-"+myX+" "+ot_liavo);
		}
		// Готово
		if ( (myX+DefaultSize) == stenaX[k]*DefaultSize && (myY+DefaultSize) >= stenaY[k]*DefaultSize && myY <=  (stenaY[k]*DefaultSize+DefaultSize)   )  {		// Ударено е кубче номер К от вътрешните стени
			ot_diasno = 1;
			window.console.log("XXXXXXX, NA-DIASNO-"+myX+" "+ot_diasno);
		}
		
		if ( ot_dolu != 0 || ot_gore != 0 || ot_liavo != 0 || ot_diasno != 0 ) {
			// Имаме удар в преграда, спира да проверява
			break;
		}
		
	}

	// Проверка дали е ВЪТРЕ В екрана
	if ( MYmoveY > 0 ) {		// Проверка дали се движи надолу
		if ( myY < 630 ) {		// Проверка дали е в екрана, дали не напуска екрана
			if ( ot_dolu == 0) {
				// Движение НАДОЛУ
				myY=myY+MYmoveY;
			} else {
			}
		}
	}
	if ( MYmoveY < 0 ) {
		if ( myY > DefaultSize ) {
			if ( ot_gore == 0) {
				// Движение НАГОРЕ
				myY=myY+MYmoveY;
			} else {
			}
		}
	}
	if ( MYmoveX > 0 ) {
		if ( myX < 960 ) {
			if ( ot_diasno == 0) {
				// Движение НАДЯСНО
				myX=myX+MYmoveX;
			} else {
			}
		}
	}
	if ( MYmoveX < 0 ) {
		if ( myX > DefaultSize ) {
			if ( ot_liavo == 0) {
				// Движение НАЛЯВО
				myX=myX+MYmoveX;
			} else {
			}
		}
	}

	// Нашето човече
	
	if ( MYmoveX >= 0 ) {
		ctx.drawImage(img1, myX, myY, DefaultSize, DefaultSize);	
	}
	if ( MYmoveX < 0 ) {
		ctx.drawImage(img4, myX, myY, DefaultSize, DefaultSize);	
	}
	
	// Изтрива стария резултат
	ctx.clearRect ( TextX_1+115 , TextY_1 + TextY_redove*2-16 , 60 , 20 );

	ctx.font = "20px Verdana";
	ctx.fillText("Hello World", TextX_1, TextY_1 + TextY_redove*1); 
	ctx.fillText("Резултат :", 	TextX_1, TextY_1 + TextY_redove*2); 

	// Печата новия:
	ctx.fillText(CollectDiamonds, 	TextX_1+115, TextY_1 + TextY_redove*2); 
	
}

function KeyUp(e) {
//	window.console.log("natisnat e buton 8888");
	window.console.log(e.code);


	if (e.code == "KeyR") {		// Running
		console.log("Otpusnat klavish R") 
		running = 0;
	}	
}

function KeyPressed(e) {
//	window.console.log("natisnat e buton 8888");
	window.console.log(e.code);

	if (e.code == "KeyR") {		// Running
		console.log("Natisnat klavish R") 
		running = running_step;
	}	

	

	// Проверява за стрелка надолу
	if (e.code == "ArrowDown") {		// Стрелка надолу
//		console.log("Strelka Nadolu") 
		MYmoveY=moveY;
		MYmoveX=stopX;
		
	}	
	if (e.code == "ArrowUp") {
//		console.log("Strelka NAGORE") 
		MYmoveY=-moveY;
		MYmoveX=stopX;
		
	}	
	if (e.code == "ArrowLeft") {
//		console.log("Strelka NALIAVO") 
		MYmoveX = -moveX;
		MYmoveY =  stopY;
		
	}	
	if (e.code == "ArrowRight") {
//		console.log("Strelka NADIASNO") 
		MYmoveX = moveX;
		MYmoveY = stopY;
	}	


	if (e.code == "Space") {
		MYmoveX=stopX
		MYmoveY=stopY
	}
  	
	window.console.log("running");
	window.console.log(running);

	
}

function init() {
	let k;
	
	// Рисува стени по хоризонтала горе и долу
	for (k = 0; k < 34; k++) {
		//Горна стена
		ctx.drawImage(img2, DefaultSize*k,   0, DefaultSize, DefaultSize);
		//Долна стена
		ctx.drawImage(img2, DefaultSize*k, 660, DefaultSize, DefaultSize);
	} 

	for (k = 0; k < 23; k++) {
		//Лява стена
		ctx.drawImage(img2,   0, DefaultSize*k, DefaultSize, DefaultSize);
		//Дясна стена
		ctx.drawImage(img2, 990, DefaultSize*k, DefaultSize, DefaultSize);
	} 
	
	// Рисува прегради, стена 1, хоризонтална
//	for (k = 0; k <= StenaMax; k++) {
	k=0;
	while(stenaX[k]>=1 && stenaX[k]<=100 && stenaY[k]>=1 && stenaY[k]<=100){
//	while(k<15){
		window.console.log(k);
		window.console.log(stenaX[k]);

		ctx.drawImage(img2, stenaX[k]*DefaultSize, stenaY[k]*DefaultSize, DefaultSize, DefaultSize);

		k++;
	} 
	StenaMax = k-1;
		window.console.log("StenaMax=");
		window.console.log(StenaMax);
	
	for (k = 0; k <= Diamand_max; k++) {
		ctx.drawImage(img3, DiamandX[k]*DefaultSize, DiamandY[k]*DefaultSize, DefaultSize, DefaultSize);
	} 
//	for (k = 2; k < 34; k++) {
//		ctx.drawImage(img2, k*DefaultSize, 20*DefaultSize, DefaultSize, DefaultSize);
//	}




	update_function();

}

// Главна функция, тук прави цикъл през 30мс
function update_function() {






	update_move ();
	setTimeout(update_function, 50);
	
	
}

function a () {
alert ("DA");
}

		</script>




	</body>
</html>
